# EBSの概要
## 1. EBSとは何か
![](../../aws_cp_ebs_overview_what_is_ebs.png)  
EBSはEC2インスタンスと共に利用されるブロック型のストレージです。  
インスタンス上のワークロードなどに利用します。  
例えばEC2インスタンスを用いてDBを構築する場合は、DBのストレージ領域にEBSを利用して処理を行ったりします。
## 2. EBSのストレージサービスの形式
まずはAWSは３つの形式のストレージサービスを提供しています。

| サービス名 | 概要 |
|-------|-------|
| ブロックストレージ | ・EC2にアタッチして活用するディスクサービス<br/>・ブロック形式でデータを保存<br/>・高速・広帯域幅<br/>・例：EBS、インスタンスストア |
| オブジェクトストレージ | ・安価かつ高い耐久性をもつオンラインストレージ<br/>・オブジェクト形式でデータを保存<br/>・デフォルトで複数AZに冗長化されている。<br/>・例：S3、Glacier |
| ファイルストレージ | ・複数のEC2インスタンスから同時にアタッチ可能な共有ストレージサービス<br/>・ファイル形式でデータを保存<br/>・例：EFS |
EC2が利用するのはブロックストレージである以下の２種類のタイプのストレージです。

| ストレージ名 | 概要 |
|-------|-------|
| インスタンスストア | ・ホストコンピュータに内蔵されたディスクでEC2と不可分のブロックレベルの物理ストレージ<br/>・EC2の一時的なデータが保持され、EC2の停止・終了と共にデータがクリアされる<br/>→長期的にデータを保存することはできないが、物理的にアタッチされているため非常に高いIO性能を出せる<br/>・無料 |
| Elastic Block Store<br/>（EBS） | ・ネットワークで接続されたブロックレベルのストレージでEC2とは独立管理<br/>→そのためEBSだけを作成することも可能<br/>・EC2を終了してもEBSデータは保持可能<br/>→デフォルト設定ではEC2終了時にアタッチされているEBSも削除される設定のため、保持する場合は設定変更が必要<br/>・SnapshotをS3に保持可能<br/>・別途EBS料金が必要 |
## 3. EBSの特徴
### 3-1. 基本
・OSやアプリケーション、データの置き場所など様々な用途で利用される  
・実体はネットワーク接続型ストレージ  
・99.999%の可用性  
・サイズは1GB～16TBの間でユーザが設定できる  
・サイズと利用期間で課金  
### 3-2. 特徴
・ボリュームデータは単一のAZ内で複数のハードウェアにデフォルトでレプリケートされており、冗長化されている。  
　→そのためAZ単位の障害には弱い部分がある  
・セキュリティグループによる通信制御対象外であり、全ポートを閉じてもEBSは利用可能  
　→EBSとの通信はAWS側で自動で管理されているためユーザ側では意識する必要はない  
・データは永続的に保存  
・他のAZのインスタンスにはアタッチできない、またEC2インスタンスから他のAZ内のEBSにアクセスすることもできない  
![](../../aws_cp_ebs_overview_ebs_over_az_access.png)  
・EC2インスタンスに複数のEBSを接続することはできるが、EBSを複数のインスタンスで共有することは基本的にはできない  
　ただしプロビジョンドIOPSというボリュームタイプであれば複数インスタンスで共有することができます。  
![](../../aws_cp_ebs_overview_ebs_multiple_ec2_access.png)  
・同じAZ内のインスタンスのみ付け替えることが可能
![](../../aws_cp_ebs_overview_ebs_same_az_instance_change.png)
## 4. EBSのボリュームタイプ
EBSのボリュームタイプは以下の性能やコストが異なる5種類のボリュームタイプからユースケースに応じて選択することができます。

| タイプ | 詳細タイプ | ユースケース | サイズ |
|-------|-------|-------|-------|
| SSD | 汎用SSD | ・仮想デスクトップ<br/>・低レイテンシーを要求するアプリ<br/>・小～中規模のデータベース<br/>・開発環境 | 1GB～16TB |
|  | プロビジョンドIOPS | ・高いI/O性能に依存するNoSQLやアプリ<br/>・10,000IOPSや160MB/s超のワークロード大規模DB<br/>・Nitro システム Amazon EC2 インスタンス、EBS最適化インスタンスタイプで高速化 | 4GB～16TB |
| HDD | スループット最適化HDD | ・ビッグデータ処理<br/>・DWH<br/>・大規模なETL処理やログ分析<br/>・ルート（ブート）ボリュームには利用不可 | 500GB～16TB |
|  | コールドHDD | ・ログデータなどアクセス頻度が低いデータ<br/>・バックアップやアーカイブ<br/>・ルート（ブート）ボリュームには利用不可 | 500GB～16TB |
| マグネティック<br/>（Magnetic） | - | ・旧世代のボリュームで基本利用しない<br/>・データへのアクセス頻度が低いワークロード | 1GB～1TB |
## 5. スナップショットの特徴
![](../../aws_cp_ebs_overview_snapshot_image.png)  
EBSはスナップショットを利用してバックアップを取得することができます。  
スナップショットの特徴として以下のような点があります。  
・スナップショットでバックアップ  
・スナップショットからEBSを別AZにも復元可能  
・スナップショットはS3に保存される  
・スナップショットの2世代目以降は増分データを保存する増分バックアップとなる（1世代目を削除しても復元は可能）  
・スナップショット作成時にブロックレベルで圧縮して保管するため、圧縮後の容量に対して課金が行われる  
・スナップショット作成時でもEBSは利用可能である。  
## 6. スナップショットの管理
スナップショットの作成時にはサーバーで変更が行われない静止点を作ることを推奨されていますが、スナップショットの実施自体はいつでも行うことが可能で、またEBSの動作には影響を与えません。  
それを含めスナップショットの管理においては以下の特徴があります。  
・スナップショット作成時はデータ整合性を保つため静止点の設定を推奨  
　– ソフトウェアの機能を利用  
　– ファイルシステムの機能を利用  
　– バックアップソフトウェアの機能を利用  
　– アプリケーションの停止  
　– ファイルシステムのアンマウントなど  
・保存期間や世代数は無制限  
・世代管理が必要な場合はAWS CLIやAPI等で自動化する  
・DLMを利用してスナップショット取得をスケジューリングできる  
## 7. スナップショットの共有
![](../../aws_cp_ebs_overview_snapshot_over_region_share.png)
スナップショットはリージョン感をまたいで利用することが可能です。

![](../../aws_cp_ebs_overview_snapshot_over_account_share.png)
またスナップショットは権限を変更することで他のアカウントに移乗することが可能です。
## 8. スナップショットとAMI
AMIとスナップショットは似ていますが、AMIはOS設定のイメージであり、スナップショットはストレージのバックアップになります。  

| 種類 | 概要 |
|-------|-------|
| AMI | ・EC2インスタンスのOS設定などをイメージとして保持して、新規インスタンス設定に転用するもの<br/>・AMI取得時にはスナップショットも取得されるため、AMIを取得すればスナップショットもバックアップを取得したことになる |
| スナップショット | ・ストレージ、EBSのその時点の断面のバックアップとして保持するもの<br/>・ストレージの復元や複製に利用 |