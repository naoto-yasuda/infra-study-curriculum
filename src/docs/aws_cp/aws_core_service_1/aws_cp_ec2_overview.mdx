# EC2の概要
## 1. EC2とは
EC2とは数分で利用可能な従量課金（時間～秒単位）で利用可能な仮想サーバーです。  
以下のような特徴があります。  
#### ・起動、ノード追加、削除、マシンスペック変更が数分で可能
#### ・汎用的なIntelアーキテクチャを採用
#### ・管理者権限で利用可能
#### ・WindowsやLinuxなどの殆どのOSをサポート
#### ・OSまでは提供されているタイプを選択することで自動設定され、OSより上のレイヤーを自由に利用可能
#### ・独自のAmazonMachineImageにOS設定を作成し、保存して再利用が可能
## 2. インスタンスとは
EC2を利用する単位をインスタンスと呼び、任意のAZにインスタンスを立ち上げてサーバーとして利用することができます。  
![](../../aws_cp_ec2_overview_ec2_instance_image.png)
## 3. EC2のセッティング
EC2のセッティングは以下のような流れで実施します。  
#### 1. 利用するAMIイメージ（OSセッティング）を選択
#### 2. インスタンスタイプを選択
#### 3. ストレージを選択
#### 4. セキュリティグループを選択
#### 5. キーペアを設定
各流れの詳細について説明します。
### 3-1. AMIイメージの選択
#### 3-1-1. AMIイメージとは
AMIイメージとはWindowsやLinuxなどのOSがある程度セッティングされて用意されているOSイメージのことを指します。  
AMIには以下の３種類が存在し、その中から使いたいAMIを選択します。

| 種類 | 概要 |
|-------|-------|
| AMI（AWS提供） | AWSが公式で提供しているAMIイメージ |
| AMI（サードパーティ提供） | サードパーティが提供しているAMI<br/>サードパーティが提供しているソフトウェアが組み込まれた形のイメージを配布するなどしている |
| カスタムAMI（自作） | 自分で構築したEC2から取得したAMIイメージ |
#### 3-1-2. AMIの特徴
AMIには以下のような特徴があります。  
・EC2インスタンスのOS設定などをイメージとして保持しており、新規インスタンス設定に利用する事ができる
・AMIの取得時にはEC2インスタンスにアタッチされているEBSのスナップショットも合わせて取得される
・インスタンスの作成時にAMIからEBSへ情報がコピーされる
・AMIは別リージョンにコピーすることができる
### 3-2. インスタンスタイプの選択
インスタンスタイプはCPU・メモリ・ストレージ・ネットワークキャパシティなどのスペックのタイプを指します。  
インスタンスタイプには汎用的なもの、コンピューティングに最適化したもの、ストレージに最適化したもの、メモリに最適化したものなど用途に応じて様々なタイプが用意されています。  
#### 3-2-1. インスタンスタイプの見方
![](../../aws_cp_ec2_overview_instance_type.png)
インスタンスタイプの見方は下記のような形になります。

| 項目 | 概要 |
|-------|-------|
| ファミリー | インスタンスタイプがどういった用途に最適化しているか |
| 世代 | 第何世代のインスタンスタイプか |
| インスタンスの容量 | インスタンスのスペック容量の大きさがどれくらいか |
#### 3-2-2. インスタンスファミリー
インスタンスファミリーは主なもので以下のような種類があります。

| ファミリーと世代 | 概要 |
|-------|-------|
| M5 | 本番環境向けの汎用的なインスタンス |
| T2 | 開発環境向けの汎用的なインスタンス |
| C5 | コンピューティングに最適化したインスタンス |
| H1 | ストレージに最適化したインスタンス |
| D2 | ストレージに最適化したインスタンス |
| R4 | メモリに最適化したインスタンス |
| X1 | メモリに最適化したインスタンス |
| F1 | FPGAに最適化したインスタンス |
| G3 | GPUに最適化したインスタンス |
特にユースケースが決まっていない場合は汎用の中から選ぶケースが多いです。  
これ以外にもインスタンスファミリーはあり、また随時AWSのバージョンアップにより内容は変わっているため最新情報は[参考ページ](https://aws.amazon.com/jp/ec2/instance-types/)をチェックしてみてください。
#### 3-2-3. インスタンスの購入形態
##### 3-2-3-1. オンデマンドインスタンス
作成したEC2インスタンスの数と時間に応じて料金が発生する、最も基本的にはEC2の料金体系です。  
デフォルトではオンデマンドインスタンスを使う形になっています。
##### 3-2-3-2. リザーブドインスタンス
利用期間を１年または３年と長期間指定して利用する形式で、オンデマンドと比較して最大で75％割安になります。  
一定的な使用量および期間が見込まれるケースや災害対策などで一定のサーバーを用意しておく場合などに利用されます。  
またリザーブドインスタンスにも以下の２種類があります。

| 項目 | スタンダード | コンバーティブル |
|-------|-------|-------|
| 利用期間 | 1年（40％割引）<br/>3年（60%割引） | 1年（31％割引）<br/>3年（54%割引） |
| AZ/インスタンスサイズ/ネットワークタイプの変更可否 | 有 | 有 |
| インスタンスファミリー/OS/テナンシー/支払オプションの変更可否 | なし | 有 |
| リザーブドインスタンスマーケットプレイスでの販売可否 | 可能 | 今後可能となる予定 |
スタンダードは利用期間中にインスタンスファミリーなどの変更ができない代わりに割引率が高く、コンバーティブルは変更ができて柔軟に利用できる代わりに割引率が若干低くなります。
##### 3-2-3-3. スポットインスタンス
AWSが持っている予備のコンピューティング容量をオンデマンドインスタンスに比べて割引（最大90％）で利用できる形式です。  
予備の容量を入札式で利用するためとても安く利用することができますが、以下のような特徴があるためユースケースを考えて利用することが必要です。
##### ・起動に通常よりも少し時間が掛かる
##### ・予備のコンピューティング容量のため利用中でも削除される可能性がある
一時的なピークや処理のために利用したり、開発環境など途中でインスタンスが終了しても問題ないケースで利用するようにしましょう。
#### 3-2-4. 物理対応可能なインスタンス
EC2ではインスタンスの共有範囲や設定ができる範囲に応じて３つのタイプをカスタムで選択することができます。

| タイプ | 概要 |
|-------|-------|
| ハードウェア専有インスタンス | 専用ハードウェアのVPCで実行されるEC2インスタンス<br/>ハードウェアのレベルで、他のAWSアカウントに属するインスタンスから物理的に分離する<br/>同じAWSアカウントのインスタンスとはハードウェアを共有する可能性がある<br/>企業によってはセキュリティポリシーでハードウェアを他社と同じにすることができない場合があり、そういったケースで利用される |
| Dedicated Host | EC2インスタンス容量を完全にお客様専用として利用できる物理サーバー<br/>サーバーにバインドされた既存のソフトウェアライセンスを利用可能<br/>ハードウェア専有インスタンスと似ているがこちらは同じAWSアカウント内でもグループ分けがされていれば特定のグループからしか利用できないなど更に細かく管理することができます |
| Bare Metal | アプリケーションが基盤となるサーバーのプロセッサーとメモリーに直接アクセス可能なインスタンス<br/>AWSの各種サービスとの連携が可能でOSが直接下層のハードウェアにアクセス可能<br/>クラウド上から物理的なサーバーを操作できるようなイメージに近いです。 |
## 3-3. ストレージの選択
EC2から直接利用するストレージは不可分なインスタンスストアと自分で設定するEBSの２つがあります。  

| 種類 | 概要 |
|-------|-------|
| インスタンスストア | ホストコンピュータに内蔵されたディスクでEC2と不可分のブロックレベルの物理ストレージ<br/>EC2の一時的なデータが保持され、EC2の停止・終了と共にクリアされる<br/>無料 |
|Elastic Block Store <br/>（EBS） | ネットワークで接続されたブロックレベルのストレージでEC2とは独立して管理される<br/>EC2をTerminateしてもEBSは保持可能で、SnapshotをS3に保持可能<br/>別途EBS料金が必要 |
## 3-4. セキュリティグループの選択
セキュリティグループはインスタンスへのトラフィックのアクセス可否を設定するファイアウォール機能を提供しています。  
セキュリティグループの詳細については[]()を参考にして下さい。
## 3-5. キーペアの設定
![](../../aws_cp_ec2_overview_keypair.png)
EC2インスタンスの作成時にキーペアを作成することができ、公開鍵はインスタンス側で保持し、秘密鍵は自身でダウンロードすることができます。  
ダウンロードした秘密鍵とEC2インスタンスの公開鍵とを突き合わせて、サーバーを管理している人のみがインスタンスにアクセスできるようにしています。