# ネットワークACLの活用（ハンズオン）
ネットワークACLを実際に設定して、EC2インスタンスに設定して動作を確認してみましょう。

## 1. ネットワークACLの設定
### 1-1. ネットワークACLの管理コンソールの表示
![](../../aws_cp_networkacl_hands_on_make_networkacl_1.png)
左上の「サービス」をクリックして、「ネットワーキングとコンテンツ配信」-「VPC」をクリックします。

![](../../aws_cp_networkacl_hands_on_make_networkacl_2.png)
左メニューの「セキュリティ」-「ネットワークACL」をクリックします。
### 1-2. ネットワークACLの設定確認
![](../../aws_cp_networkacl_hands_on_make_networkacl_3.png)
ネットワークACLの一覧で、「VPC ID」がVPCのハンズオンで作成したものと同じものを選択して、「インバウンドルール」タブをクリックします。  

ルール番号100番に全てのトラフィック、全てのプロトコル、全てのポート、全ての送信元を許可しているルールがデフォルトで設定されているため現在はすべての通信が許可されている状態です。  
ルール番号＊に拒否の設定がありますが、ルール番号100番に全ての通信が条件として一致するためこの設定が適用されることはありません。

![](../../aws_cp_networkacl_hands_on_make_networkacl_4.png)
同様に「アウトバウンドルール」タブの内容を確認します。  
こちらも同じ様に設定が行われており、デフォルトでは全ての通信が許可されている状態です。
### 1-3. ネットワークACLの設定変更 - 101番への拒否ルール
![](../../aws_cp_networkacl_hands_on_make_networkacl_5.png)
「インバウンドルール」タブを開き、「インバウンドルールを編集」をクリックします。

![](../../aws_cp_networkacl_hands_on_make_networkacl_6.png)
「新しいルールを追加」をクリックして入力欄を増やし、下記のように設定を入力して「変更を保存」をクリックします。  
なお「変更をプレビュー」をクリックすることで変更した結果がどうなるかを保存前に確認することもできます。

| 項目 | 設定値 | 設定値 |
|-------|-------|-------|
| ルール番号 | 101 | ルールの適用順 |
| タイプ | HTTP | 通信のタイプ |
| プロトコル | TCP | 通信のプロトコル |
| ポート範囲 | 80 | 通信ポート |
| 送信元 | 0.0.0.0/0 | 送信元のIPアドレス |
| 許可/拒否 | 拒否 | 通信を許可するか拒否するか |

![](../../aws_cp_networkacl_hands_on_make_networkacl_7.png)
同様にアウトバウンドルールも設定します。  
「アウトバウンドルール」タブを開き、「アウトバウンドルールを編集」をクリックします。

![](../../aws_cp_networkacl_hands_on_make_networkacl_8.png)
「新しいルールを追加」をクリックして入力欄を増やし、下記のように設定を入力して「変更を保存」をクリックします。  
なお「変更をプレビュー」をクリックすることで変更した結果がどうなるかを保存前に確認することもできます。

| 項目 | 設定値 | 設定値 |
|-------|-------|-------|
| ルール番号 | 101 | ルールの適用順 |
| タイプ | HTTP | 通信のタイプ |
| プロトコル | TCP | 通信のプロトコル |
| ポート範囲 | 80 | 通信ポート |
| 送信元 | 0.0.0.0/0 | 送信元のIPアドレス |
| 許可/拒否 | 拒否 | 通信を許可するか拒否するか |

設定してもらったようにセキュリティグループとは違い、外からこちらにアクセスしに来るインバウンドとこちらから外にアクセスしに行くアウトバウンドのそれぞれを設定する必要があります。  
また通信を許可するのか拒否するのかを設定できるのもセキュリティグループと異なる点です。
### 1-4. ネットワークACLの動作確認 - 101番への拒否ルール
![](../../aws_cp_networkacl_hands_on_make_networkacl_9.png)
EC2のハンズオンで作成したインスタンスのパブリックIPアドレスにブラウザからアクセスして、EC2のハンズオンで作成したWebページが表示されることを確認します。  

この手順で設定したのは101番目のルールのため、先に全てのトラフィックの通信を許可する100番のルールが適用されるのでWebページにアクセスすることができます。
### 1-5. ネットワークACLの設定変更 - 99番の拒否ルール
![](../../aws_cp_networkacl_hands_on_make_networkacl_10.png)
先程101番で設定したインバウンドルールのルール番号を「99」に変更して「変更を保存」をクリックします。

### 1-6. ネットワークACLの動作確認 - 99番の拒否ルール
再度EC2のハンズオンで作成したインスタンスのパブリックIPアドレスにブラウザからアクセスします。  

![](../../aws_cp_networkacl_hands_on_make_networkacl_11.png)
今度は読み込み状態のまま画面の表示が完了せずに、最終的にはタイムアウトのエラー画面が表示されます。  

今回設定したのは99番目のルールのため、HTTPアクセスを拒否するルールが先に適用されるのでWebページにアクセスができないのです。

### 1-7. ネットワークACLの設定戻し
インバウンドルールに設定した99番のルールを削除しておきましょう。