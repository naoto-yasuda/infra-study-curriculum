# セキュリティグループとネットワークACL
## セキュリティグループとは
セキュリティグループとは、インスタンスへのトラフィックのアクセス可否を設定するファイアウォール機能を提供しているサービスになります。  

セキュリティグループはデフォルトの状態だと自分と同じセキュリティグループから以外の全ての通信を拒否する設定になっています。  
その状態から接続を許可したい通信をセキュリティグループに対して設定していく形になります。  
設定は
- 何のプロトコルの通信か（何番のポートか）
- 接続元はどこからか
を設定してアクセスをコントロールします。

![](../../aws_cp_securitygroup_and_networkacl_securitygroup_image.png)
図の場合、セキュリティグループに対してポート22番のSSHの通信のみを許可する設定を行っています。  
こうすることでTeraTermなどでSSHによるアクセスは行うことができますが、ブラウザなどからHTTPアクセスを行ってもセキュリティグループを通過することができずアクセスはできません。  
また接続元の設定が「0.0.0.0/0」であれば全てのIPアドレスを許可していることになるのでどこからでも接続することができますが、会社で所有している固定IPアドレスを設定すれば会社のネットワークからのみアクセスができるように制限を行うことができます。

![](../../aws_cp_securitygroup_and_networkacl_securitygroup_network_image.png)  
図のようにセキュリティグループは各インスタンスごとに個別に作成・設定することができます。  
セキュリティグループに設定する内容が同一ならば１つのセキュリティグループを複数のインスタンスに設定することも可能です。
## ネットワークACLとは
ネットワークACLとは、サブネットに対するトラフィック制御ができる機能を提供しているサービスになります。  
セキュリティグループと機能は似ていますが、活用方法には違いがあります。

![](../../aws_cp_securitygroup_and_networkacl_networkacl_image.png)
セキュリティグループは各インスタンス（サーバー）単位で設定しますが、ネットワークACLはVPCもしくはサブネット単位で設定を行います。  
またデフォルトでは全ての通信を許可する設定になっています。  
その状態から接続を許可・拒否したい通信をネットワークACLに対して設定していく形になります。
設定はセキュリティグループと同様な
- 何のプロトコルの通信か（何番のポートか）
- 接続元はどこからか
に加えて、
- ルールの適用順
- 許可か拒否か
を設定してアクセスをコントロールします。
## セキュリティグループとネットワークACLの比較
セキュリティグループとネットワークACLは上述の通り似ている部分、異なる部分がありますがまとめると以下のようになります。

| 項目 | セキュリティグループ | ネットワークACL |
|-------|-------|-------|
| 適用単位 | インスタンス（サーバー）単位 | VPC/サブネット単位 |
| ステート | ステートフル<br/><br/>インバウンド（外から自サーバーへのアクセス）のみ設定すればアウトバウンドも許可される | ステートレス<br/><br/>インバウンド設定だけではアウトバウンドは許可されない<br/><br/>外から自サーバーへアクセスされる許可を設定しても、自サーバーから外にアクセスするための許可も別途行う必要がある |
| 指定の内容 | 許可のみをIn/Outで指定 | 許可と拒否をそれぞれIn/Outで指定 |
| デフォルトの状態 | デフォルトでは同じセキュリティグループからの通信のみ許可し、他は全て拒否 | デフォルトでは全ての通信を許可する |
| ルールの適用方法 | 全てのルールを適用する | 適用順の番号通りに適用され、ルールに一致した時点で以降の番号ののルールは無視されます<br/><br/>例えば１番目で全てのプロトコル、全ての接続元を許可するルールを設定した場合、２番目以降の設定で特定のポートを制限しても無視されてしまいます<br/><br/>逆に例えば１番目の設定でSSHのポートは拒否する設定をして、２番目で全てのプロトコルを許可する設定を行うとSSH以外の通信が行える設定にすることができます|

