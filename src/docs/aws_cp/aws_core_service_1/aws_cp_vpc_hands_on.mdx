# VPCによるネットワーク構築（ハンズオン）
今回のハンズオンでは以下の内容を実施します。  
1. VPCを作成する
2. インターネットゲートウェイを作成する
3. サブネットを３つ作成する
4. サブネットに対してインターネットに接続する設定を実施する

# 1. VPCを作成する
## 1-1. VPCダッシュボードへの移動
![](../../aws_cp_vpc_hands_on_make_vpc_1.png)
マネジメントコンソールの検索窓に「VPC」と入力し、検索結果の「VPC」をクリックする
## 1-2. VPCの管理画面への移動
![](../../aws_cp_vpc_hands_on_make_vpc_2.png)
左のメニューから「VPC」をクリックする
## 1-3. VPCの作成
![](../../aws_cp_vpc_hands_on_make_vpc_3.png)
「VPCを作成」をクリックする

![](../../aws_cp_vpc_hands_on_make_vpc_4.png)
以下のように設定を入力して「VPCを作成」をクリックする

| 項目             | 設定値                           | 項目概要                                                                                                                    |
| ---------------- | -------------------------------- | --------------------------------------------------------------------------------------------------------------------------- |
| 名前タグ         | test                             | VPCの名前                                                                                                                   |
| IPv4CIDRブロック | 10.0.0.0/16                      | VPCのIPv4のCIDR設定<br/>/16にするのを推奨                                                                                   |
| IPv6CIDRブロック | IPv6CIDRブロックなし             | VPCのIPv6のCIDR設定<br/>特別な要件が無ければ、基本的になしを選択します                                                      |
| テナンシー       | デフォルト                       | VPCの配置先を専用のハードウェアにするかどうか<br/>こちらも特別な要件が無ければ、基本的にデフォルトを選択します              |
| タグ             | そのままデフォルト値のままとする | AWSリソースに割り当てるラベル<br/>Nameタグは自動的に付与されます<br/>それ以外のタグについては管理上の必要に応じて設定します |

![](../../aws_cp_vpc_hands_on_make_vpc_5.png)
VPCの一覧に作成したVPCが表示されていることを確認します。

# 2. インターネットゲートウェイを作成する
各家庭ではインターネットにアクセスする際に出入り口となるルーターを設定してアクセスをしていると思います。  
VPCにおけるそのルーターとなるのがインターネットゲートウェイです。  
## 2-1. インターネットゲートウェイの管理画面への移動
![](../../aws_cp_vpc_hands_on_make_igw_1.png)
左のメニューから「インターネットゲートウェイ」をクリックする
## 2-2. インターネットゲートウェイの作成
![](../../aws_cp_vpc_hands_on_make_igw_2.png)
「インターネットゲートウェイの作成」をクリックする

![](../../aws_cp_vpc_hands_on_make_igw_3.png)
以下のように設定を入力して「インターネットゲートウェイの作成」をクリックする

| 項目     | 設定値                           | 項目概要                                                                                                                    |
| -------- | -------------------------------- | --------------------------------------------------------------------------------------------------------------------------- |
| 名前タグ | test                             | VPCの名前                                                                                                                   |
| タグ     | そのままデフォルト値のままとする | AWSリソースに割り当てるラベル<br/>Nameタグは自動的に付与されます<br/>それ以外のタグについては管理上の必要に応じて設定します |

![](../../aws_cp_vpc_hands_on_make_igw_4.png)
作成したインターネットゲートウェイが表示されることを確認します。
## 2-3. VPCへのインターネットゲートウェイのアタッチ
先程のインターネットゲートウェイの画面を確認してもらうと、「状態」が「Detached」になっていると思います。  
つまりこのインターネットゲートウェイは現在どこにもアタッチされていない状態です。  
このインターネットゲートウェイを利用するために先ほど作成したVPCにアタッチしていきます。

![](../../aws_cp_vpc_hands_on_make_igw_5.png)
「アクション」-「VPCにアタッチ」をクリックする

![](../../aws_cp_vpc_hands_on_make_igw_6.png)
「使用可能なVPC」にハンズオンで作成したVPCを選択し、「インターネットゲートウェイのアタッチ」をクリックする

![](../../aws_cp_vpc_hands_on_make_igw_7.png)
「状態」が「Attached」になっており、「」がハンズオンで作成したEC2のものになっていることを確認する
# 3. サブネットの作成
VPCを小分けしたネットワークに分割するためにサブネットを作成していきます。  
[サブネットとサブネットマスク](aws_cp_subnet_and_subnetmask)で例に上げた
- blue（ブルー）
- green（グリーン）
- red（レッド）

のサブネットを作成していきます。
## 3-1. サブネットの管理画面への移動
![](../../aws_cp_vpc_hands_on_make_subnet_1.png)
左のメニューから「サブネット」をクリックする
## 3-2. サブネットの作成
![](../../aws_cp_vpc_hands_on_make_subnet_2.png)
「サブネットを作成」をクリックする

![](../../aws_cp_vpc_hands_on_make_subnet_3.png)
以下のように設定を入力して「サブネットを作成」をクリックする  
同時に複数のサブネットを作成することができるので、「新しいサブネットを追加」をクリックして３つ同時に作成する

| 項目                     | 設定値                                                                               | 項目概要                                                                                                                    |
| ------------------------ | ------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------- |
| VPC ID                   | ハンズオンで作成したtest                                                             | サブネットを作成するVPCのID                                                                                                                            |
| サブネット名             | １つ目：blue<br/>２つ目：green<br/>３つ目：red                                       | サブネットの名称                                                                                                                            |
| アベイラビリティーゾーン | １つ目：ap-northeast-1a<br/>２つ目：ap-northeast-1a<br/>３つ目：ap-northeast-1c<br/> | サブネットを配置するAZ<br/><br/>複数のAZにサブネットを配置することでAWSが推奨するMulti-AZの構成を作ることができるようになります                                                                                                                            |
| IPv4CIDRブロック         | １つ目：10.0.0.0/24<br/>２つ目：10.0.1.0/24<br/>３つ目：10.0.2.0/24<br/>             | サブネットのCIDR設定<br/><br/>VPCに設定したCIDRより大きい値を設定してVPCを更に小分けのネットワークに区分します<br/><br/> 推奨は/24です。<br/>今回はVPCが/16のためIPアドレスの最初の２オクテット分はロックされるので３つ目のオクテットから区分けを行っています                                                                                                                           |
| タグ                     | そのままデフォルト値のままとする                                                     | AWSリソースに割り当てるラベル<br/><br/>Nameタグは自動的に付与されます<br/>それ以外のタグについては管理上の必要に応じて設定します |

![](../../aws_cp_vpc_hands_on_make_subnet_4.png)
サブネットの一覧に作成したサブネットが表示されていることを確認します。
# 4. サブネットに対してインターネットに接続する設定を実施する
今回はblueサブネットがインターネットにアクセスできるように設定を行います。  
そのためにはblueサブネットに対してインターネットゲートウェイの設定を行う必要があります。  
サブネットへのインターネットゲートウェイの設定はサブネットが使用しているルートテーブルを編集することで行います。
## 4-1. ルートテーブルの管理画面への移動
![](../../aws_cp_vpc_hands_on_setting_routetable_1.png)
サブネットの一覧からblueサブネットを選択して、「ルートテーブル」タブを開き、「ルートテーブル：」の右に表示されているルートテーブルIDのリンクをクリックします。
## 4-2. ルートの編集
![](../../aws_cp_vpc_hands_on_setting_routetable_2.png)
ルートテーブルの管理画面に移動するので、「ルート」タブを開き、「ルートを編集」をクリックします。

![](../../aws_cp_vpc_hands_on_setting_routetable_3.png)
「ルートを追加」をクリックします。

![](../../aws_cp_vpc_hands_on_setting_routetable_4.png)
以下のように設定を入力して、「変更を保存」をクリックします。

| 項目 | 設定値 | 項目概要 |
|-------|-------|-------|
| 送信先 | 0.0.0.0/0 | トラフィックを送信するIPアドレスの範囲<br/><br/>今回は範囲を決めず全開放したいので全て０の値にしています |
| ターゲット | 先ほど作成したインターネットゲートウェイ<br/>（test） | 送信先トラフィックの送信に使用するゲートウェイ |

![](../../aws_cp_vpc_hands_on_setting_routetable_5.png)
設定を変更したルートテーブルの「ルート」タブを開き、先程追加したルートが表示されるのを確認します。  

# 5. まとめ
これでblueサブネットがインターネットにアクセスできる状態になりました。  
このblueサブネットに対してEC2インスタンスなどを配置していくことで、外部からアクセスできるサーバーを構築することができます。