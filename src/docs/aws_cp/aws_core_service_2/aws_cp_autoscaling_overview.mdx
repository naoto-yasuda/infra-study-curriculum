# AutoScalingの概要
## 1. AutoScalingとは
スケーラビリティの確保はインフラ構成の信頼性やパフォーマンスに大きく影響する要素ですが、特にこのAutoScalingの利用方法がスケーラビリティを確保する上で重要なポイントになります。  

![](../../aws_cp_autoscaling_overview_autoscaling_image.png)
例えばELBで通信量を試算してEC2インスタンスを割り当てて運用しているものの、想定より遥かに通信量が大きくなりそうでELBにでEC2インスタンスに振り分けても全然捌ききれずシステムが正しく動かなくなっている…という状況は往々にして発生します。  
このようなケースの場合、もしオンプレミスだったらサーバーを選定して調達して構築して…となって１ヶ月以上掛かってしまいます。  
また新しいサーバーを組み込むために現在のシステムを止める必要もあるかも知れません。  
AWSだとしても１からEC2を作成してサーバーの設定を行うのはある程度時間を要します。  
そのようなケースの時に自動でサーバーを構築して増やしてくれるのがこのAutoScalingの機能になります。
## 2. AutoScalingのスケーリングタイプ
一般的にスケーリングのタイプには垂直スケーリングと水平スケーリングの２種類がありますが、AutoScalingは水平スケーリングです。  

| 項目 | 垂直スケーリング | 水平スケーリング |
|-------|-------|-------|
| 拡張方法 | スケールアップする<br/>スケールアップはメモリやCPUなどをサーバーに追加して、サーバー１台あたりのスペックを増強すること | スケールアウトする<br/>スケールアウトは処理する機器やサーバー台数を追加して、サーバー１台あたりの性能は変えずに数で勝負する方法のこと |
| 低減方法 | スケールダウンする<br/>スケールダウンはメモリやCPUなどをサーバーから外して、サーバー１台あたりのスペックを下げること | スケールインする<br/>スケールインは処理する機器やサーバー台数を削減すること |
## 3. AutoScalingの要素
AutoScalingは次の３つの要素で構成されています。
- AutoScalingグループ
- AutoScalingConfiguration（起動設定）
- AutoScalingプラン
### 3-1. AutoScalingグループ
AutoScalingグループには、スケールするインスタンスの最大数など基本情報を設定します。  

主な機能をまとめると、
- 起動インスタンスの最小数と最大数を設定する
  - 例えば通常時は２台で、需要増でスケールアウトする際は最大で５台になるようにするといったことができる
- 今時点で必要な最適なインスタンス数（Desired Capacity）の数量になるようにインスタンスを起動／終了を調整
- 起動台数をAZ間でバランシングする
- AZ障害時は障害のない別のAZにその分のインスタンスを起動する
### 3-2. AutoScalingConfiguration（起動設定）
AutoScalingConfigurationには、スケールアウトの際に起動するインスタンス内容を設定します。  
基本的にはAMIを選んで、インスタンスタイプを決めて、セキュリティグループを選んでというようにEC2の作成時と同じ様な設定を行っていきます。

主要な設定項目としては、
- AMI
- インスタンスタイプ
- セキュリティグループ
- キーペア
- IAMロール
### 3-3. AutoScalingプラン
AutoScalingプランには、どの様にスケールするかの方法を定義します。  
方法のパターンとしては、

| 方法 | 内容 |
|-------|-------|
| AutoScalingGroupサイズの維持 | 現在のAutoScalingGroupのインスタンス最小台数を維持する設定をする |
| 手動スケーリング | 設定外で予期せぬスケーリングが必要となった場合に手動でスケーリングを実施 |
| スケジュールベース | 予測された需要増時期にあわせたスケーリングスケジュールを設定<br/><br/>例えば１２月はクリスマスがあるから需要増が予想されるからスケールアウトする、といったようにイベントなどのスケジュールに合わせてスケーリングすることができます |
| 動的スケーリング | 予測不能なケースにスケーリングポリシーにスケール方針を設定して、動的にスケールアウトを実施<br/><br/>急な需要増などを検知して自動でスケールアウトさせる方法です |

AutoScalingプランは複数組み合わせて利用することもできます。  
例えばスケーリングをスケジュールで予め設定しておいて、その上で更にスケーリングが必要なら動的スケーリングさせる、といったような設定が可能です。  
そのためスケーリングのプランを１つに限定せずに、色々と組み合わせることで最適なものを作っていくことができるのが特徴です。
## 4. ヘルスチェック
AutoScaling配下のEC2のヘルスチェックにはEC2のステータス情報、またはELBのヘルスチェックのどちらかを利用することができます。  
ELBとセットでAutoScalingを設定したほうがELBのヘルスチェック機能を活用して、より詳細なAutoScalingができるため便利です。

| 項目 | 内容 |
|-------|-------|
| EC2ステータス | インスタンスのステータスがrunning以外の状態を異常と判断 |
| ELB | ELBのヘルスチェック機能を活用する |