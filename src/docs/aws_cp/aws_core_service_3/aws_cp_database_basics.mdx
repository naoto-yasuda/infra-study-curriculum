# データベースの基礎
## 1. データベースとは
### 1-1. DBMS（データベースマネジメントシステム）
![](../../aws_cp_database_basics_database_image.png)
データベースは関連したデータを形式を揃えて収集・整理して、検索などの操作やデータ管理を実行するシステムです。  
新規にデータをデータベースに保存したり、そのデータベースからデータを抽出するといった作業をこのデータベースでやっています。
データベースを実現したシステムをDBMS（データベースマネジメントシステム）と言います。  
### 1-2. テーブル
![](../../aws_cp_database_basics_database_table_image.png)
基本的なデータベースはテーブルという表形式でデータを格納しています。  
Excelのような表敬式で行ごとにデータを追加したり、削除したりするのが最も基本的なデータベースのデータ構造になっています。  
これをテーブルと呼びます。
### 1-3. CRUD
データベースは追加・参照・更新・削除などのデータ操作を容易に実行するソフトウェアやデータモデルと一体化されたものです。  
追加・参照・更新・削除を総称してCRUDと呼びます。  
このCRUD操作を実現するのがデータベースです。

| CRUD | 操作 | 内容 |
|-------|-------|-------|
| Create | 追加 | データを整理して保存したい |
| Read | 参照 | 必要なデータを参照または抽出したい |
| Update | 更新 | データの変化に応じて好きな時に更新したい |
| Delete | 削除 | 必要ないデータを削除したい |
## 2. データベースとストレージ
ストレージはデータベースの記憶装置を構成する１つの要素です。  
それぞれの違いは以下のようになります。
### 2-1. ストレージ
- コンピュータの主要な構成要素の１つで、データを永続的に記憶する装置
### 2-2. データベース
- データベース内のデータを保存する装置はストレージであるが、データベースそのものではない
- ストレージ＋データを管理・操作するデータベースソフトウェアでデータベースになる
## 3. データベースの役割
データベースの役割を支える仕組みを理解しましょう。
### 3-1. データベースの役割とは
データベースはデータ操作を異常なく実行でき、データを安全に保護しつつ、保存・操作ができる仕組みを提供しています。  
以下のようなケースの場合にデータベースソフトウェアを使って、データベースマネジメントシステムが処理をしてくれます。
#### ※データ操作にかかる様々な課題
- システムがクラッシュしたときにデータが消えないか？
- データを誤って削除してしまった場合に対処できないか？
- データ抽出に誤りが発生しないか？
- 2人が同時に同じデータにアクセスした際にどうするか？
- 大量のデータを上手く検索できないか？
### 3-2. トランザクション
#### 3-2-1. トランザクションとは
トランザクションとはデータベースをある一貫した状態から別の一貫した状態へ変更する１つの処理の束のことです。  
以下のようなケースでデータの正常性を保つための機能です。
- 同時アクセスした場合に上手く処理する
- データ処理に失敗したら、元に戻してくれる
- システムがクラッシュしてもデータを保護する
#### 3-2-2. ACID
ACIDとは信頼性のあるトランザクションシステムが持つべき性質のことです。

| ACID | 性質 | 説明 |
|-------|-------|-------|
| Atomicity | 原子性 | トランザクションが「すべて実行される」か「一つも実行されない」のどちらかの状態になるという性質<br/><br/>トランザクションという単位でデータの処理をしていきます<br/>トランザクションという処理単位でデータベースの操作がされていきますが、処理が途中で失敗した場合にちゃんと実行が終わっていれば終わらせる、終わっていなかったら元に戻して実行されない状態をキープするという動きをします |
| Consistency | 整合性 | トランザクションの前後でデータの整合性が保たれ、矛盾の無い状態が継続される性質<br/>例えばデータを参照した場合はトランザクションの前後で参照してもデータを変更されないので、データが変わりないといった整合性を担保する習性があります<br/>またデータを削除したらトランザクションが終わればその対象のデータが消えているなど、そういった処理前後での整合性を全部で一貫させる動きをします |
| Isolation | 独立性 | トランザクション実行中の処理過程が外部から隠蔽され、他の処理などに影響を与えない性質<br/>データを更新したり削除したりといった作業をやっていると、途中でアプリケーションがそのデータを参照した時に大きな影響を与えないようにしなければいけません<br/>ちゃんと実行中の場合でも他のアプリケーションからの操作を遮断するなどして他の処理などに影響を与えない性質のことを言います |
| Durability | 耐久性 | トランザクションが完了したら、その結果は記録され、クラッシュしても失われることがないという性質<br/>トランザクション途中でデータベースが止まってしまったりした時にデータが失われてしまうといった事が発生しないように、処理をちゃんとキープするという動きをします |
#### 3-2-3. 整合性
![](../../aws_cp_database_basics_database_consistency_1.png)
![](../../aws_cp_database_basics_database_consistency_2.png)
同時に複数人がアクセスした場合などのデータのデータ整合性を維持するための方式で、結果整合性や強い整合性と整合性にも種類があります。  
それぞれの整合性に優劣はなく、データベースの用途や特性に応じて使い分けられます。
- 結果整合性：変更中のデータが完了していない間も、他の人は古いデータを参照（確認）できる
- 強い整合性：変更中のデータが完了するまで、他の人は古いデータが参照できない
#### 3-2-4. 耐久性
![](../../aws_cp_database_basics_database_durability.png)
データを更新する際にCOMMITとすると更新が反映されますが、COMMITがされないとデータがロールバックして保護されます。
### 3-3. データモデル
![](../../aws_cp_database_basics_datamodel.png)
データモデルとは実世界におけるデータの集合をDBMS上で利用可能な形に落とし込むためのモデルで、データベースのデータの持ち方などの構造や処理を定めるデータの論理的な表現方法です。  
データベースには様々なデータモデルが存在し、利用目的に応じて使い分けます。
- リレーショナルモデル
- グラフモデル
- キーバリューストア
- オブジェクト
- ドキュメント
- ワイドカラム
- 階層型