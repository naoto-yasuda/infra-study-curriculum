# CloudWatchの概要
## 1. CloudWatchとは
CloudWatchとはAWSリソースとAWSで実行するアプリケーションのモニタリングサービスで、様々なログやメトリクスを監視できるAWSの基本的なモニタリングツールとなっています。  

CloudWatchが実行する内容としては主に以下の６つの領域があります。
- モニタリング
- 監視の集約化
- トラブルシューティング
- ログ解析
- 自動アクション
- 運用状況の確認

ログ解析とモニタリングを集約して実施でき、それに基づいてトラブルシューティングや運用状況の確認をさせたり、ある閾値を超えたら自動でアクションを実行するといった設定を行うことができます。
## 2. CloudWatchの主な機能
### 2-1. CloudWatch（メトリクス監視）
AWS上で稼働するシステム監視サービスで、
- 死活監視
- 性能監視
- キャパシティ監視  

を実施することができます。  
無料で基本は使うことができますが、有料枠では確認する内容や設定の柔軟性が充実化させることができます。
### 2-2. CloudWatch Logs
CloudWatchと連動したログ管理プラットフォームサービスです。  
EC2上のOS・アプリケーションのログやAWSマネージドサービスのログを取得することができます。
### 2-3. CloudWatch Events
CloudWatchでAWSリソースに対するイベントをトリガーにアクションを実行することができます。  
オペレーションの変更に応答して応答メッセージを送信したり、機能のアクティブ化をしたりということができます。  
また自動で状態の情報収集を行って修正のアクションをトリガーに基づいて自動で実行するといったこともできます。
## 3. CloudWatchの動き
![](../../aws_cp_cloudwatch_overview_cloudwatch_flow.png)
CloudWatchではデータの取得・表示・アクションの実行までを集中管理することができますが、全体の動きとしては図のような形になります。  
データリソースと呼ばれるデータの取得元があって、その取得元のサービスからデータを取得して、その取得したデータの可視化やデータに基づいたアクションの実行をしたりという３つの段階に分かれています。  
このデータの取得の部分において主な機能として説明した、
- CloudWatch（メトリクス監視）
- CloudWatch Logs
- CloudWatch Events

という機能を使っています。  

データリソースからデータを取得するサービスとしては、CloudWatch Agentというサービスがあります。  
これはEC2インスタンスなどのAWSサービスにCloudWatch Agentを導入することで詳細なサーバーのメトリクスを取得できるようにすることができます。  
ただしAgentを導入しなくても基本的なAWSサービスのメトリクスは自動で取得できるようになっています。  

またCloudWatch Logsに対応するものであれば、EC2インスタンスやVPCなどでログ取得を有効化することによってCloudWatch Logs側でログを取得できるようにすることができます。  
そして取得したログはメトリクスへと送られる形となり、メトリクスの内容に基づいてイベントがトリガーされます。

イベントのトリガーによって行えるアクションについてですが、例えばLambdaなどの他AWSサービスに連携して何らかの処理をしたり、アラームを設定してメール通知をしたりということができます。

またCloudWatchのダッシュボードという機能を利用して好きなデータを使ってグラフ表示をすることができたり、CloudWatch Logs Insightsという機能でログ情報を可視化することができたり、ログの内容に関する分析を行うことができます。

## 4. CloudWatchのメトリクス
CloudWatchメトリクスを利用して、多くのメトリクスと呼ばれるAWSサービスの利用データを取得することができます。  
CloudWatchメトリクスは主に以下の２種類があります。
- 標準メトリクス
- カスタムメトリクス
### 4-1. 標準メトリクス
標準メトリクスはデフォルトで既に取得されているもので、AWSリソースを何らかの形で使えば必ずこのメトリクスが取得できている状態です。  
つまりCloudWatch側で何らかの設定をしなくても自動で取得し始めています。  

CPU使用率、ディスク利用率、読み込みIOPSなどの一般的なメトリクスの多くが取得可能で、５分間隔で取得されます。
### 4-2. カスタムメトリクス
カスタムメトリクスは拡張モニタリングという有料枠を実行する際に設定できるもので、高解像度のメトリックと呼ばれたりもします。  
標準では取得できないメトリクスを取得することができ、例えばEC2のメモリ利用率は標準メトリクスでは取得できないのですがカスタムメトリクスで設定を行うことで取得ができるようになります。

またメトリクスの取得間隔が１秒から６０秒のリアルタイムでメトリクスを取得することができます。
## 5. CloudWatchダッシュボード
![](../../aws_cp_cloudwatch_overview_dashboard.png)
CloudWatchダッシュボードは必要なメトリクスを選択してダッシュボードでグラフでメトリクスを可視化することが可能です。  
各サービスの管理画面のモニタリング画面などで同じ様にグラフを確認することができますが、CloudWatchダッシュボードの場合は自分で表示する項目やグラフの表示の仕方をカスタマイズすることができます。