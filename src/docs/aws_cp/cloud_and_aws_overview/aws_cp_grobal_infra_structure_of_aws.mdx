# AWSのグローバルインフラ構成
## 1. AWSの仕組み
### 1-1. 機能のサービス提供
インフラやアプリ開発に必要な機能がAWSのサービスとして提供されています。  
例えば、
#### オンプレサーバー　→　EC2
#### ストレージ　→　S3
といったようにこれまでオンプレミスで物理的に構築していたものをAWSのサービスに置き換えるような形で利用することができます。 
### 1-2. 時間および金銭コストの気軽さ 
それぞれのサービスが基本的に数分で利用を開始することができ、また使った時間や容量の分だけを課金される従量課金になります。  
そのためサーバーの準備に大量の時間やコストが必要なオンプレミスに比べて気軽に利用をすることができます。
### 1-3. サービスの組み合わせ
![](../../aws_cp_grobal_infra_structure_of_aws_service_combination.png)
上記の図で四角で表されているのは全てAWSのそれぞれのサービスになります。  
図上ではネットワーク、サーバー、ストレージ、DNS等だけですが、他にも膨大な数のサービスが提供されています。  
ユーザは数あるサービスの中から自身が必要とする機能のサービスをパズルのように組み合わせて、希望する構成を実現するような仕組みになっています。  

例えば図の場合、最初にEC2を１台建て、その後にもしその１台が止まっても良いように冗長化構成を組みたいとなった時はもう１台EC2を同じ様に建てELBを作ってアクセスを分配するといったようなことがすぐに実現することができます。  
同じ様にデータベースを使いたいからRDSを、ストレージを使いたいからS3をというようにサービスを使ってすぐに実現することができます。
### 1-4. アンマネージド型とマネージド型
AWSのサービスにはアンマネージド型とマネージド型が存在し、それぞれ以下のような特徴を持っています。  
AWSのサービスの多くはマネージド型で提供されており、ユーザが利用しやすい形になっています。

|  | アンマネージド型 | マネージド型 |
|-------|-------|-------|
| 概要 | 拡張や障害への対応などをユーザで設定し、管理する必要がある | 拡張や障害への対応がサービスに組み込まれており、AWS側で管理されている |
| メリット | 設定が柔軟にできる | 管理が楽 |
| デメリット | 管理が面倒 | 設定が限定的 |
| 代表的サービス | EC2 | Route53 |
## 2. AWSのグローバルインフラ構成
### 2-1. AWSのインフラの配置場所における3つの区分
![](../../aws_cp_grobal_infra_structure_of_aws_region_and_az_and_edgelocation.png)
AWSのインフラの配置場所は
#### 　1. リージョン
#### 　2. リージョンの中にあるアベイラビリティーゾーン（AZ）
#### 　3. AZより更に細かく配置されたエッジロケーション
という3つの区分により構成されています。
### 2-2. リージョン
![](../../aws_cp_grobal_infra_structure_of_aws_region_map.png)
リージョンは国や地域における地理的に隔離されたAWSの拠点です。  
クラウドサービスは世界中のどこからでも利用できる必要があるため、AWSは世界中に拠点を配置しています。  
日本には東京と大阪の２つのリージョンが設定されています。  

リージョンとリージョンは物理的に独立したインフラ拠点ですが、東京と大阪の様に隣接するリージョン間は広帯域の専用ネットワークで接続されています。  
利用するリージョンによって利用できるAWSサービスとサービスの課金額が異なるため注意が必要です。  
例えばアメリカ東部のバージニアリージョンでは新サービスがリリース当初から利用できたりしますが、東京リージョンでは少し期間を置いて利用できるようになったりします。
#### 2-2-1. リージョンの選択
基本的にはシステムを利用するユーザに最も近いリージョンを選択します。  
ただしリージョンの置かれている国によってはその国の法律に影響される可能性を考慮する必要があります。  
例えば中国国内のリージョンではデータの持ち出しの制限やデータの提示の義務などの影響があります。
#### 2-2-2. 複数リージョンの連携
よりサービスの信頼性を高めるために別のリージョンにデータやシステムの予備を別リージョンに配置して利用することもできます。  
各リージョン間では専用線の接続や各サービスのレプリカの作成ができるようになっています。
### 2-3. アベイラビリティーゾーン（AZ）
リージョンの中に複数の独立したインフラ拠点が存在しており、それをアベイラビリティーゾーン（略してAZ）と呼びます。  
![](../../aws_cp_grobal_infra_structure_of_aws_availability_zone.png)
１つのリージョンには２つ以上のAZが存在しており、同じリージョン内のAZ同士は低レイテンシー（低遅延）のリンクで接続されています。  
AZは１つの物理的なデータセンターで構成されており、１つのデータセンターには数千のサーバーが収容されています。  
その膨大な物理インフラを仮想化してユーザーに各種のインフラ機能をサービスとして提供しています。  
#### 2-3-1. 複数リージョンを利用する構成
１つのAZだけでAWSサービスを利用しているとデータセンターが停止した場合にサービスが停止する可能性があります。  
複数AZを連携させて信頼性の高いシステム構成にするのが基本的なAWSのアーキテクチャとなります。  
ただし複数AZを連携させる場合は多くの場合そのための設定をそれぞれ設定する必要があります。
### 2-4. エッジロケーション
エッジロケーションはキャッシュデータなどを利用するサービスにおいてAZより更に小さなエンドポイント（接続先）となる拠点です。  
CloudFrontなど一部のサーバーで利用されますが、世界の各地に配置されており、ユーザがデータをダウンロードする際にエッジロケーションの中から最も近い拠点からダウンロードをすることで高速にダウンロードさせることができます。  
またこの際エッジロケーションにデータをキャッシュしておくことで、わざわざ大本のサーバーにデータを取りに行く時間が省略できより高速にすることができます。  