# AWSコスト管理
## 1. AWSのコスト管理に関するサービス
AWSには運用保守やサポートに関する支援ツールやサービスとして以下のようなものがあります。

| サービス名 | 説明 |
|-------|-------|
| AWS Cost Explorer | AWS のコストと使用量や経済性を把握し・分析・管理するための可視化ツール |
| AWSのコストと使用状況レポート | AWS のコストと使用状況の詳細を確認するためのレポート |
| AWS Budgets | 予算のしきい値を超えたときにアラートを発信するカスタム予算を設定 |
| 価格算定ツール | AWS のコスト計算を支援するツール<br/>簡易見積りツール/TCO計算ツール/Pricing Calculator |
| AWS Cost Categories | 自身の組織やプロジェクト構造にわけてコストをカテゴライズすることが可能な機能 |
| Trusted Advisor | コスト最適化とセキュリティと対障害性とパフォーマンス向上についてアドバイスを提供するサービス |
## 2. AWSを安く使うには
AWSを安く使うために最もシンプルで一番最初にやるべきコスト最適化は以下の２点です。
- AWSの無料利用枠
- 最適な料金オプションを選択
## 3. AWSの課金方式
AWSは利用量に応じた柔軟な価格設定となっています。  
特徴として以下のようなものがあります。
### 3-1. 従量課金
従量課金による利用料に応じた価格設定が基本です。
### 3-2. 予約による低価格
EC2などの特定のサービスにはリザーブド価格（予約による低価格販売）が実施されています。
### 3-3. 使うほど安い
AWS ではボリュームディスカウントを受けることができるため、使用量が増えるほど節約することが出来ます。
## 4. AWSの料金改定
他のクラウドサービスとの競争のため、頻繁に料金改定が行われており利用ごとに料金表を確認することをおすすめします。  
各サービスの料金は[こちら](https://aws.amazon.com/jp/pricing/)のリンクから確認することが出来ます。
## 5. EC2の購入オプション
### 5-1. 購入オプションの種類
EC2の購入オプションは下記のように種類があり、利用形態や利用期間などに応じて多岐に渡るため、コスト最適な選択をすることが重要です。
- オンデマンドインスタンス
- スポットインスタンス
- リザーブドインスタンス
- ハードウェア専有インスタンス
- Dedicated Host
- ベアメタル
### 5-2. リザーブドインスタンス
#### 5-2-1. リザーブドインスタンスとは
リザーブドインスタンスは利用期間を長期指定して利用する形式で、オンデマンドに比較して最大75％割安になります。

| 項目 | スタンダード | コンバーティブル |
|-------|-------|-------|
| 利用期間 | 1年（40％割引）<br/>3年（60%割引） | 1年（31％割引）<br/>3年（54%割引） |
| AZ／インスタンスサイズ／ネットワークタイプ変更可否 | 有 | 有 |
| インスタンスファミリー／OS／テナンシー／支払オプションの変更可否 | なし | 有 |
| リザーブドインスタンスマーケットプレイスでの販売可否 | 可能 | 今後可能となる |

リザーブドインスタンスのユースケースとしては以下のようなものがあります。
- 一定した状態または使用量が予測可能なワークロード
- 災害対策などキャパシティ予約が可能なアプリケーション
#### 5-2-2. AWS Organizationsによる一括請求
AWS Organizationsの一括請求により、メンバーアカウント間でリザーブドインスタンスを共有化したり、S3などの利用量に応じた課金がお得になります。
##### 5-2-2-1. ボリュームディスカウント適用
S3などのボリューム料金階層があるサービスの場合だと、多く利用するほど利用量あたりの単価は下がっていきます。  
そのため一括請求で複数アカウントの利用量をまとめることで利用量あたりの単価が下がった状態で支払いできるためコスト削減することが可能になります。
##### 5-2-2-2. リザーブドインスタンスの共有
一定の条件においてメンバーアカウント間で購入したリザーブドインスタンスを共有することが出来ます。
- AWS Organizationsで有効化
- 同じAZ内に購入する
- 同じインスタンスタイプである
### 5-3. スポットインスタンス
スポットインスタンスとは予備のコンピューティング容量を、オンデマンドインスタンスに比べて割引（最大90%引き）で利用できるEC2インスタンスです。  
特徴として以下のようなものがあります。
- 予備用を入札式で利用するためとても安い（最大90％引き）
- 起動に通常よりも少し時間がかかる
- 予備用のため途中で削除される可能性がある
  - 一時的な拡張などの用途で利用
### 5-4. 物理対応可能なインスタンス
AWSには物理サーバーにインスタンスを起動して制御が可能なタイプのインスタンスが複数存在します。
#### 5-4-1. ハードウェア専有インスタンス
- 専用HWのVPCで実行されるEC2インスタンス
- ホストHWのレベルで、他の AWS アカウントに属するインスタンスから物理的に分離する
- 同じAWSアカウントのインスタンスとはHWを共有する可能性がある
#### 5-4-2. Dedicated Host
- EC2インスタンス容量を完全にお客様専用として利用できる物理サーバー
- サーバーにバインドされた既存のソフトウェアライセンスを利用可能
#### 5-4-3. Bare Metal
- アプリケーションは基盤となるサーバーのプロセッサーとメモリーに直接アクセス可能なインスタンス
- AWSの各種サービスとの連携が可能でOSが直接下層のハードウェアにアクセス可能
### 5-5. Saving Plan
Saving Planとは１～３年の期間に一定の使用量を守ることによりコストを削減することが出来ます。  
具体的には以下のような特徴があります。
- リザーブドインスタンスと同様に、1 年または 3 年の期間に特定の量の処理能力 (USD/時間で測定) を使用する契約を結ぶことで適用される割引契約
- AWS コンピューティング使用料金を最大 72% 節約できる
- Amazon EC2、AWS Fargate、AWS Lambda に適用可能
## 6. 価格算定ツール
AWSには公式の価格算定ツールがあり、これらの公式ツールを利用して見積や価格比較を実施することが出来ます。
### 6-1. 簡易見積りツール
必要なサービス数からシンプルにAWSコストを試算するツールで、利用するAWSサービスに対する月額料金を見積ることができます。  
ただし既に廃止済みで利用できなくなっています。
### 6-2. TCO計算ツール
AWSを利用した場合とオンプレミス環境やコロケーション環境との価格を比較して節約できるコストを見積もることができます。  
こちらも既に廃止済みで利用できなくなっています。
### 6-3. Pricing Calculator
ビジネスや個人のニーズに沿った個別の予測コスト見積りを実施することができます。  
## 7. CloudWatch
CloudWatchのBilling機能により請求額に対するアラーム設定が可能です。
## 8. AWS Budgets
カスタム予算を設定して、コストまたは使用量が予算額や予算量を超えた場合に細かくアラームを設定することができます。
## 9. Cost Explorer
AWS のコストと使用量の経時的変化を可視化して、カスタムレポートを作成してコストと使用量のデータを分析することができます。
## 10. AWSのコストと使用状況レポート
AWS のコストと使用状況に関する最も包括的データを提供しています。  
アカウント／IAMユーザーが使用した各サービスカテゴリのAWS使用状況が、時間単位または日単位の明細項目として一覧表示されます。
## 11. AWS Cost Categories
自身の組織やプロジェクト構造にわけてコストをカテゴライズすることが可能な機能です。
## 12. AWS Trusted Advisor
コスト最適化とセキュリティと対障害性とパフォーマンス向上についてアドバイスを提供するサービスです。