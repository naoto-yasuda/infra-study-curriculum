# データベース
## 1. AWSのデータベースサービス
AWSでは様々なタイプのデータベースサービスがマネージド型サービスで提供されています。  
以下のようなサービスがあります。

| サービス名 | 説明 |
|-------|-------|
| Amazon RDS | MySQL、PostgreSQL、Oracle、SQL Server、MariaDB 向けのマネージドリレーショナルデータベースサービス |
| Amazon Aurora | MySQL および PostgreSQL と互換性のあるクラウド向けの分散・高速化されたリレーショナルデータベース |
| Amazon DynamoDB | 規模に関係なく数ミリ秒台のパフォーマンスを実現する、keyvalue およびドキュメント型のNoSQL型のデータベース |
| Amazon ElastiCache | Redis または Memcached に互換性のある完全マネージド型のインメモリ・キャッシュDB（NoSQL型） |
| Amazon Redshift | 高速かつシンプルで、費用対効果の高いデータウェアハウス |
## 2. Aurora
### 2-1. Auroraとは
Auroraとは、AWSがクラウド時代に適したリレーショナルDBを一から考えて構築された新しい分散型のリレーショナルデータベースです。  
NoSQL型の分散高速処理とRDBとしてデータ操作性を両立させています。

AuroraはMySQLの２．５～５倍の性能を商用データベースの１０分の１の価格で提供する高性能・低コストDBです。  
RDSにおいてデータベースソフトウェアの１つとして選択することができます。
### 2-2. Auroraの特徴
Auroraの特徴には以下のようなものがあります。
#### 2-2-1. 高い並列処理性能によって大量の読み書きをするのに適したDB
- 高い並列処理によるストレージアクセスによってクエリを高速処理することが可能
- Auroraは大量の書き込みや読み込みを同時に扱うことができる
- データベースの集約やスループット向上が見込まれる
- ただし、すべてが5倍高速というわけではなく、適用すべき領域を見つけて利用する
#### 2-2-2. 互換性
- MySQL／PostgreSQLと互換性があり、同じ操作方法とそのコミュニティを利用することが可能
#### 2-2-3. 分散型で耐障害性と自己回復性を備えたスケーラブルな新しいタイプのフルマネージド型RDB
##### 2-2-3-1. 耐障害性/自己回復性
- 3つのAZに2つのコピーを設置可能で合計6つのコピーを保持
- 過去のデータがそのままS3に継続的バックアップ
- リストアも差分適用がなく高速
- どのタイミングでも安定したリストア時間を実現
- 99.99％の高可用性・高耐久性
##### 2-2-3-2. スケーラビリティ
- 10GBから最大64TBを提供するSSDデータプレーンを利用してシームレスに拡張可能
- Auto-Scalingなどのクラウド独自のスケーラブルが可能
- 最大15のリードレプリカを利用した高速読み込みが可能
## 3. DynamoDB
### 3-1. DynamoDBとは
DynamoDBとは完全マネージド型のNoSQLデータベースサービスです。
### 3-2. DynamoDBの特徴
DynamoDBには以下のような特徴があります。
- ハイスケーラブルで無制限に性能を拡張できる
- 負荷が高くなっても応答速度が低下しない低レイテンシー
- 高可用性（SPOFなしでデータは3箇所のAZに保存）
- マネージド型のためメンテナンスフリー：CloudWatchで運用
- プロビジョンドスループット
  - テーブルごとにReadとWriteに、必要なスループットキャパシティを割り当てる<br/>例）Read:100／Write:1000
- ストレージの容量制限がない
  - データ容量の増加に応じたディスクやノードの増設は一切不要
### 3-3. DynamoDBの出来ること
DynamoDBはキーバリュー（ワイドカラム型）でデータを簡易に操作することができます。  
DynamoDBの出来ることと出来ないこと/向いていないことをまとめると以下のようになります。
#### 3-3-1. 出来ること
- キーに対するバリュー（値）のCRUD操作
- 簡易なクエリやオーダー
- 例えば、数万人以上が同時アクセスして処理が必要になるアプリケーションのセッションデータ処理など
#### 3-3-2. 出来ないこと/向いていないこと
- JOIN／TRANSACTION／COMMIT／ROLLBACKは不可
- 詳細なクエリやオーダー（データの検索や結合処理などには向いていない）
- 大量のデータ読み書きにはコストがかかる
### 3-4. DynamoDBの整合性モデル
DynamoDBの整合性はデフォルトで結果整合性モデルであり、一部処理に強い整合性モデルを利用しています。
#### 3-4-1. Write
- 少なくとも２つのAZでの書き込み完了が確認とれた時点で完了
#### 3-4-2. Read
- デフォルト：結果整合性モデル
  - 最新の書き込み結果が即時読み取り処理に反映されない可能性がある
- オプション：強い整合性モデル
  - GetItem／Query／Scanでは強い整合性のある読み込みオプションが指定可能
### 3-5. DynamoDBのユースケース
DynamoDBのユースケースは、ビックデータ処理向けか、大量データ処理が必要なアプリケーション向けに利用するのが適しています。  
例えば大量に発生しうるWeb行動データやログ管理などです。  
具体的には以下のようなユースケースになります。
#### 3-5-1. ビックデータ
- 大量のデータを収集・蓄積・分析するためのデータベースとして活用
- Hadoopと連携してビッグデータ処理が可能
#### 3-5-2. アプリケーション
- 大規模サービスでのデータ高速処理が必要なアプリケーション向けに活用
- 多数のユーザーが一度にアクセスするようなアプリケーションのデータ処理など
#### 3-5-3. ユーザー行動データ管理
- ユーザー情報やゲーム、広告などのユーザー行動データ向けDB
- ユーザーIDごとに複数の行動履歴管理
#### 3-5-4. バックエンドデータ処理
- モバイルアプリのバックエンド
- バッチ処理のロック管理
- フラッシュマーケティング
- ストレージのインデックス
## 4. ElastiCache
### 4-1. ElastiCacheとは
ElastiCacheとは、分散員メモリキャッシュサービスの構築・管理およびスケーリングを用意に実施することが出来るサービスです。
### 4-2. ElastiCacheの特徴
ElastiCacheの特徴としては以下のようなものがあります。
- キャッシュクラスタを数クリックで起動
- フルマネージド型でモニタリング、自動障害検出、復旧、拡張、パッチ適用、バックアップに対応し高可用性を実現
- 広く利用されている2種類のエンジン（Redis／Memcached）から選択可能
### 4-3. インメモリキャッシュとは
ElastiCacheはインメモリキャッシュという仕組みを利用しており、メモリ＋キャッシュというデータベースの構造になっています。  

![](../../aws_cp_database_inmemorycache_image.png)
インメモリキャッシュとはメモリを活用して高速にキャッシュへのアクセ雨を可能にしたデータベースの仕組みのことです。  
例えばDBのデータの中で変更が行われないマスタデータなどを事前にキャッシュに書き込んでおくことで、マスタデータを取得する際はわざわざDBに取りに行かずに、高速なメモリへのアクセスでキャッシュからデータを取得することで高速なデータのやり取りを実現することが出来ます。
### 4-4. ElastiCacheで使えるDBエンジン
ElastiCacheではDBエンジンとしてオープンソースのRedisとMemcachedを利用することが可能で汎用性があります。  

それぞれのDBエンジンの特徴としては以下のようなものがあります。
#### 4-4-1. Redis
Memcachedと比較して高機能で複雑な設定を行うことが出来ます。
- 高速に値をRead/Writeできるインメモリキャッシュ型DB
- シングルスレッドで動作するインメモリキャッシュDBで全てのデータ操作は排他的
- スナップショット機能がある
- データを永続化できる
#### 4-4-2. Memcached
Redisと比較してシンプルに利用することが出来ます。
- 高速に値をRead/Writeできるインメモリキャッシュ型DB
- マルチスレッドで動作するインメモリキャッシュDB
- スナップショット機能がない
- データを永続化できない
- フェイルオーバーや復元ができない
## 5. Redshift
### 5-1. Redshiftとは
Redshiftとは、高速でスケーラブルな費用対効果の高いマネージド型のDWH／データレイク分析サービスです。
### 5-2. Redshiftの特徴
Redshiftは以下のような特徴があります。
- 数百ギガバイトのデータから開始して、ペタバイト以上まで拡張
- 1 テラバイトあたり年間 1,000 USD 以下で利用可能
- 自動ワークロード管理など自動テーブルメンテナンスなど多くのメンテナンスタスクやデータ配置が自動化されているフルマネージド型
- PostgreSQL互換の列指向データモデル
- 複数ノードをまとめたクラスター構成。単一AZで起動し、マルチAZ構成は不可
- RA3インスタンスで最大で他のクラウドデータウェアハウスの 3 倍に達するパフォーマンス
- AQUAによる分散キャッシュで、Redshift が他のクラウドデータウェアハウスに比べて最大 10 倍の速度で動作
### 5-3. データレイク
![](../../aws_cp_database_datalake_image.png)
Redshiftはデータレイクとして使われるS3と共にデータ活用のハブとして利用することが出来ます。
## 6. それぞれのサービスのユースケース
AWSのデータベースサービスのユースケースに応じた使い分けを理解して、実際の試験問題に対応できるようにしましょう。
各サービスのユースケースをまとめると以下の通りになります。

| サービス名 | 説明 |
|-------|-------|
| Amazon RDS | AWSでリレーショナルデータベースを構築するケースではRDSを選択する |
| Amazon Aurora | 高速分散処理が必要なリレーショナルデータベースと限定された場合はAuroraを選択する |
| Amazon DynamoDB | AWSでNoSQL型のデータベースを利用する場合は、まずはDynamoDBを選択する |
| Amazon ElastiCache | NoSQL型のデータベースの中で、インメモリ型／キャッシュ型のDBと限定された場合はElastiCacheを選択する |
| Amazon Redshift | AWSでデータウェアハウスと限定された場合はRedshiftを選択する |