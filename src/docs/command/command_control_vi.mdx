# コマンド操作の学習「vi」
viコマンドはLinuxサーバーの標準のテキストエディタを起動するためのコマンドです。  
LinuxサーバーはWindowsのようにメモ帳などがあるわけではなく、テキストの編集は基本的にこのviコマンドで起動したエディタを用いて行います。
## 1. 基本コマンド
```shell
vi <ファイル名>
```
指定したファイルが存在していればそのファイルを開き、存在していなければ新しいファイルとして編集を始めます。  
testディレクトリのtest.txtファイルをviコマンドで開く場合は以下のようにコマンドを実行します。
```shell
vi test/test.txt
```
## 2. viエディタの基本的な使い方
### ※コマンド試し用ファイルの準備
本ページのコマンドを試すためのファイルは以下のコマンドを一通り実行することで作成することができます。
```shell
mkdir ./test/
echo '# テスト１' > test/test.txt
echo 'test1 = "/test1/testtest1/"' >> test/test.txt
echo '# テスト２' >> test/test.txt
echo 'test2 = "/test2/testtest2/"' >> test/test.txt
echo '# テスト３' >> test/test.txt
echo 'test3 = "/test3/testtest3/"' >> test/test.txt
```
### 2-1. viエディタの起動時
起動時は編集することができないコマンドモードで開始します。  
コマンドモードの状態ではカーソルキーを動かしてファイルの内容を閲覧することができます。
### 2-2. 入力モードとコマンドモード
viエディタは入力モードに移るためのキーと、切り取りやコピーができるコマンドモードのキーがあります。  
### 入力モードのキー
#### 2-2-1. iキー：現在のカーソル位置に文字を挿入する
現在のカーソル位置に文字を挿入したい時は「i」キーを入力します。  
例えば「test1 = "/test1/testtest1/"」の最後の「/」にカーソルを合わせた状態で「i」キーを入力し、その後「2」「3」と入力するとカーソルの位置から「23」と追記されます。

■編集前
```
# テスト１
test1 = "/test1/testtest1/"
# テスト２
test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
■編集後
```
# テスト１
test1 = "/test1/testtest123/"
# テスト２
test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
編集が完了した後は「ESC」キーを押すことでコマンドモードに戻ることができます。
#### 2-2-2. Rキー（大文字）：現在のカーソル位置から文字を上書きする
現在のカーソル位置から文字を上書きしたい時は「R」キーを入力します。  
例えば「test1 = "/test1/testtest1/"」の「/test1/」の最初の「t」にカーソルを合わせた状態で「R」キーを入力し、その後「p」「r」「o」「d」と入力するとカーソルの位置から「prod」と上書きされます。

■編集前
```
# テスト１
test1 = "/test1/testtest1/"
# テスト２
test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
■編集後
```
# テスト１
test1 = "/prod1/testtest1/"
# テスト２
test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
編集が完了した後は「ESC」キーを押してコマンドモードに戻りましょう。
#### 2-2-3. Aキー（大文字）：現在のカーソル行の最後に文字を追記する
現在のカーソル行の最後に文字を追記したい時は「A」キーを入力します。  
例えば「# テスト１」の行のどこかにカーソルを合わせた状態で「A」キーを入力し、その後「テ」「ス」「ト」と入力するとカーソル行の最後から「テスト」と追記されます。

■編集前
```
# テスト１
test1 = "/test1/testtest1/"
# テスト２
test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
■編集後
```
# テスト１テスト
test1 = "/test1/testtest1/"
# テスト２
test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
編集が完了した後は「ESC」キーを押してコマンドモードに戻りましょう。
#### 2-2-4. Oキー（大文字）：現在のカーソル行の前の行に行を挿入する
現在のカーソル行の前の行に行を挿入したい時は「O」キーを入力します。  
例えば「# テスト２」の行のどこかにカーソルを合わせた状態で「O」キーを入力すると現在の行の上の行に１行空白行が挿入されます。

■編集前
```
# テスト１
test1 = "/test1/testtest1/"
# テスト２
test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
■編集後
```
# テスト１
test1 = "/test1/testtest1/"

# テスト２
test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
編集が完了した後は「ESC」キーを押してコマンドモードに戻りましょう。
#### 2-2-5. oキー（小文字）：現在のカーソル行の次の行に行を挿入する
現在のカーソル行の次の行に行を挿入したい時は「o」キーを入力します。  
例えば「# テスト２」の行のどこかにカーソルを合わせた状態で「o」キーを入力すると現在の行の下の行に１行空白行が挿入されます。

■編集前
```
# テスト１
test1 = "/test1/testtest1/"
# テスト２
test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
■編集後
```
# テスト１
test1 = "/test1/testtest1/"
# テスト２

test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
編集が完了した後は「ESC」キーを押してコマンドモードに戻りましょう。
#### ！入力モードの注意点！
編集が完了したら必ず「ESC」キーを押すことを忘れないように意識しましょう。  
入力モード中は上下左右にカーソル移動したり、「DELETE」キーによる削除などは行えず想定外の文字が入力されます。  
誤って入力をしてしまった場合は慌てずにコマンドモードにして削除の操作をしたり、「BACKSPACE」キーによる編集を行いましょう。

### コマンドモードのキー
#### 2-2-6. xキー：現在のカーソルの文字を１文字削除する
現在のカーソルの文字を削除したい時は「x」キーを入力します。  
例えば「test1 = "/test1/testtest1/"」の行の「testtest1」の「t」にカーソルを合わせた状態で「x」キーを４回入力すると「testtest1」が「test1」に修正されます。

■編集前
```
# テスト１
test1 = "/test1/testtest1/"
# テスト２
test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
■編集後
```
# テスト１
test1 = "/test1/test1/"
# テスト２
test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
#### 2-2-7. yyキー：１行コピーし、クリップボードへ格納する
現在のカーソル行をコピーしたい時は「yy」キーを入力します。  
例えば「test1 = "/test1/testtest1/"」の行のどこかにカーソルを合わせた状態で「yy」キーを入力すると、この行がコピーされクリップボードに登録されます。  
クリップボートの内容を貼り付けしたい時は貼り付け先の前の行にカーソルを合わせて「p」キーを入力します。
例えば「test1 = "/test1/testtest1/"」の行のどこかにカーソルを合わせた状態で「p」キーを入力すると、クリップボートの内容が下に挿入されます。  

■編集前
```
# テスト１
test1 = "/test1/testtest1/"
# テスト２
test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
■編集後
```
# テスト１
test1 = "/test1/testtest1/"
test1 = "/test1/testtest1/"
# テスト２
test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
#### 2-2-8. ddキー：１行切り取り、クリップボードへ格納する
現在のカーソル行を切り取りたい時は「dd」キーを入力します。  
例えば「test1 = "/test1/testtest1/"」の行のどこかにカーソルを合わせた状態で「dd」キーを入力すると、この行が切り取られクリップボードに登録されます。  
クリップボートの内容を貼り付けしたい時は貼り付け先の前の行にカーソルを合わせて「p」キーを入力します。
例えば「# テスト２」の行のどこかにカーソルを合わせた状態で「p」キーを入力すると、クリップボートの内容が下に挿入されます。  

■編集前
```
# テスト１
test1 = "/test1/testtest1/"
# テスト２
test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
■編集後
```
# テスト１
# テスト２
test1 = "/test1/testtest1/"
test2 = "/test2/testtest2/"
# テスト３
test3 = "/test3/testtest3/"
```
#### 2-2-9. :数字：指定行に移動する
特定の行数に移動したい時は「:数字」を入力します。  
設定ファイルやバッチファイルでエラーが発生した際、エラーメッセージに表示された行数に移動する時などに便利です。
#### 2-2-10. /文字列：カーソルの後方を検索する
ファイル内の特定の文字列の場所へ移動したい時は「/文字列」を入力します。  
WindowsにおけるCtrl+Fと同様に利用することができます。  
「/文字列」を実行した後は「n」キーで次の該当文字列の場所へ移動できます。  
また「N」キーで前の該当文字列の場所へ移動できます。
#### 2-2-11. u：直前の操作を取りやめる
viエディタの編集中に直前の操作を取りやめたい場合は「u」キーを入力します。  
WindowsにおけるCtrl+Zと同様に利用することができます。
#### 2-2-12. set nu：行番号を表示する、set nonu：行番号を非表示にする
エディタ内に行番号を表示したい場合は「set nu」を入力します。  
また行番号を表示中に「set nonu」を入力することで非表示にすることができます。
#### 2-2-13. :qキー：viエディタを閉じる
viエディタを終了したい時は「:q」キーを入力します。  
ファイルに変更を加えた状態で入力するとエラーが表示されて終了できません。  
その場合はこの後説明する「:q!」キーや「:wq」キーを利用しましょう。
#### 2-2-14. :q!キー：ファイルを破棄してviエディタを閉じる
ファイルへの変更を破棄してviエディタを終了したい時は「:q!」キーを入力します。  
修正した内容を破棄したい場合や、新規作成しようとしたファイルを保存したくない場合に利用しましょう。
#### 2-2-15. :wキー：viエディタを終了せずにファイルを保存する
ファイルの保存をしたい時は「:w」キーを入力します。  
「:w」キーの場合はviエディタを終了せずに保存ができるため、引き続き編集をしたい場合などは「:w」キーを利用しましょう。
#### 2-2-16. :wqキー：ファイルを保存してviエディタを終了する
ファイルを保存してviエディタも終了したい場合は「:wq」キーを入力します。  
一通り編集を行って後は保存するだけ、という場合は「:wq」キーを利用しましょう。
## 3. Tips
### 3-1. ファイルを新規作成するときの動きについて
viコマンドでファイルを新規作成したい場合は作成したいファイル名を指定するだけでOKです。  
ファイル名で指定しているファイルが存在しなければファイルが新規作成されます。
```shell
vi <ファイル名>

vi <ディレクトリ名>/<ファイル名>
```
この際、ディレクトリも存在していなければ作成してくれます。  
ただファイルを保存する操作をするまでは実際にファイルやディレクトリは作成されません。
## 4. 学習用サーバーに接続して、実際にコマンドを試してみましょう
[リンク](https://bellard.org/jslinux/)を開いて、「x86 Alpine Linux 3.12.0 Console」の「click here」をクリックしましょう。  
出てきたコンソール画面に対してコマンドを入力してみてください。  
上手くいかない時は教育担当までご連絡をお願いします。
