# コマンド操作の学習「grep」
grepコマンドはファイル中の文字列を検索するコマンドです。  
設定ファイルの内容を確認したり、ログの内容を確認したり等様々な場面で利用する便利なコマンドです。
## 0. 事前準備
### ※コマンド試し用ファイルの準備
本ページのコマンドを試すためのファイルは以下のコマンドを一通り実行することで作成することができます。
```shell
mkdir test
echo -e 'Apple\n123\n.txt' > test/test01.txt
echo -e 'Orange\n456\n.doc' > test/test02.txt
echo -e 'Grape\n789\n.xls' > test/test03.txt
```
## 1. 基本コマンド
ファイル内の文字列を検索する場合は下記のコマンドで行うことができます。
```shell
grep <検索正規表現> <ファイル名>

例：testディレクトリのtest01.txtファイル内の「Apple」という文字列を検索したい場合
grep Apple test/test01.txt

※実行結果例
Apple
```
ディレクトリ内のファイルを全て検索したり、ワイルドカードでファイルを指定して検索することもできます。
```shell
例：testディレクトリのファイルから「Apple」という文字列を検索したい場合
grep Apple test/*

※実行結果例
test/test01.txt:Apple


例：testディレクトリの.txtファイルから「Orange」という文字列を検索したい場合
grep Apple test/*.txt

※実行結果例
test/test02.txt:Orange
```
AND（なおかつ）検索をしたい場合は以下のように指定をします。
```shell
grep <検索正規表現その１> <ファイル名> | grep <検索正規表現その２>

```
また１文の中でAND検索をしたい場合は次のように正規表現を利用します。
```shell
```
## 2. 便利なmvコマンドのオプション
### 2-1. -iオプション：上書きになる時は確認を行う
-iオプションを利用することで上書き移動をする場合に確認を行うようになります。  
上書きしてしまうと元に戻せないので、重要なファイルを扱っている際は便利です。
```shell
mv -i <移動元> <移動先>
```
### 2-2. -bオプション：上書き時にバックアップファイルを作成する
-bオプションを利用することで上書き時にバックアップファイルを作成することができます。  
上述の-iオプションで確認を行うことも大事ですが、バックアップファイルを作ることでより安全に作業が行なえます。
```shell
mv -b <移動元> <移動先>

例：testディレクトリのtest01.txtをtest_moveディレクトリにtest01.txtとしてバックアップファイルを作りつつ上書き移動する場合
mv -b test/test01.txt test_move/test01.txt
※バックアップファイルはtest01.txt~として作成されます
```
バックアップ時に後ろに付ける文字列は--suffixオプションで指定することができます。  
基本的には以下のように指定して日付を付けるのがおすすめです。
```shell
mv -b --suffix=_$(date +%Y%m%d) <移動元> <移動先>

例：testディレクトリのtest01.txtをtest_moveディレクトリにtest01.txtとしてバックアップファイルを作りつつ上書き移動する場合
mv -b --suffix=_$(date +%Y%m%d) test/test01.txt test_move/test01.txt
※バックアップファイルはtest01.txt_20210921のように日付が付与されて作成されます
```
### 2-4. -vオプション：移動した情報を表示
-vオプションを利用することで何が移動されたかの情報を表示してくれます。  
ワイルドカードを使ってファイルを移動した際に付けておくと分かりやすくて便利です。
```shell
mv -v <移動元> <移動先>

例：testディレクトリ配下の.txt拡張子のファイルをtest_moveディレクトリに移動したい場合
mv test/*.txt test_move/

※実行結果例
`test/test01.txt` -> `test_move/test01.txt`
`test/test02.txt` -> `test_move/test02.txt`
`test/test03.txt` -> `test_move/test03.txt`
`test/test04.txt` -> `test_move/test04.txt`
`test/test05.txt` -> `test_move/test05.txt`
```
## 3. 学習用サーバーに接続して、実際にコマンドを試してみましょう